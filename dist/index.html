<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Creator</title>
  <script src="https://js.stripe.com/v3/"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script type="importmap">
{
  "imports": {
    "express": "https://esm.sh/express@^5.1.0",
    "path": "https://esm.sh/path@^0.12.7",
    "url": "https://esm.sh/url@^0.11.4",
    "cors": "https://esm.sh/cors@^2.8.5",
    "@google/generative-ai": "https://esm.sh/@google/generative-ai@^0.24.1",
    "firebase/": "https://esm.sh/firebase@^12.1.0/"
  }
}
</script>
  <script type="module" crossorigin src="/assets/index-Cvc6_v-X.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/index-C3zlaruL.css">
</head>
<body>
 <header class="app-header">
  <div class="header-brand">
   <span class="app-title">Video Creator</span>
  </div>
  <div class="header-auth-status">
   <div id="auth-section" class="auth-section">
    <button id="google-sign-in-button" class="google-sign-in-button">
      <i class="fa-brands fa-google" aria-hidden="true"></i>
      Sign in with Google
    </button>
   </div>
    <div class="user-actions" style="display: none;">
        <button id="buy-credits-button">
            <i class="fa-solid fa-cart-plus" aria-hidden="true"></i>
            <span>Buy Credits</span>
        </button>
        <div id="credit-balance-display"></div>
        <div class="user-profile-menu">
            <button id="user-profile-trigger" aria-haspopup="true" aria-expanded="false">
                <img id="user-profile-picture" src="" alt="User Profile Picture">
                <span id="user-name"></span>
                <i class="fa-solid fa-chevron-down" aria-hidden="true"></i>
            </button>
            <div id="user-profile-dropdown">
                <button id="sign-out-button" class="dropdown-item">
                    <i class="fa-solid fa-right-from-bracket" aria-hidden="true"></i>
                    Sign Out
                </button>
            </div>
        </div>
    </div>
  </div>
 </header>
  <main>
    <div class="container">
      <header>
        <h1>Video Creator</h1>
        <p>Generate vertical video clips and edit them into engaging Shorts.</p>
      </header>

      <div class="tabs">
        <button id="generator-tab-button" class="tab-button active" data-view="generator-view">
          <i class="fa-solid fa-clapperboard" aria-hidden="true"></i>
          Clip Creator
        </button>
        <button id="studio-tab-button" class="tab-button" data-view="editor-view">
           <i class="fa-solid fa-photo-film" aria-hidden="true"></i>
          Editor
          <span id="studio-notification-badge" class="notification-badge" style="display: none;"></span>
        </button>
      </div>

      <div class="content-views">
        <div id="generator-view">
          <div class="generator-content-wrapper">
            <div id="generation-panel">
              <div class="controls">
                <div class="form-group">
                  <label for="idea-input">1. Describe your idea briefly</label>
                  <textarea id="idea-input" rows="2" placeholder="e.g., a calm beach at sunrise with a lone surfer"></textarea>
                  <button id="generate-ideas-button" class="action-button full-width" aria-label="Craft a detailed prompt from your idea">
                    <i class="fa-solid fa-wand-magic-sparkles" aria-hidden="true"></i>
                    Generate detailed prompt
                  </button>
                </div>

                <div class="form-group">
                  <label for="prompt-input">2. Detailed Prompt</label>
                  <textarea id="prompt-input" rows="5" placeholder="Click 'Generate detailed prompt' above to create a prompt here, or write your own."></textarea>
                </div>

                <div class="form-group" id="conditioning-image-group">
                  <label for="file-input">3. Conditioning Image (Optional)</label>
                  <input id="file-input" type="file" accept="image/*" />
                  <div id="image-preview-container" class="image-preview-container" style="display: none;">
                    <img id="image-preview" src="" alt="Image preview" />
                    <button id="clear-image-button" class="clear-button" aria-label="Clear image"><i class="fa-solid fa-xmark" aria-hidden="true"></i></button>
                  </div>
                </div>
                <div class="form-group">
                  <div class="form-info">
                      <p><i class="fa-solid fa-circle-info"></i> Using <strong>Veo 2</strong> model. Max duration: <strong>4 seconds</strong>. All clips are generated in 9:16 portrait format.</p>
                  </div>
                </div>
                <button id="generate-button" class="generate-button">Generate Video</button>
              </div>
              <div class="latest-result-wrapper">
                <h2>Latest Generation</h2>
                <div id="status" class="status">
                  <div class="placeholder">
                    <span class="placeholder-icon">üé¨</span>
                    Click "Generate Video" to create a new clip.
                  </div>
                </div>
              </div>
            </div>
            <div id="library-panel">
              <h2>My Clips Library</h2>
              <div id="quota-error" style="display: none;">
                <p>You have exceeded your generation quota. Please try again later.</p>
              </div>
              <div id="results-gallery" class="results-gallery">
                <div id="gallery-placeholder" class="placeholder">
                    <span class="placeholder-icon">üéûÔ∏è</span>
                    Your generated clips will appear here.
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="editor-view" style="display: none;">
          <header class="editor-header">
            <div class="header-section">
               <h2>Studio</h2>
               <button id="sequence-settings-button" class="action-button">
                  <i class="fa-solid fa-sliders"></i> Sequence Settings
              </button>
            </div>
            <div class="header-actions">
              <button id="export-video-button" class="action-button">
                <i class="fa-solid fa-download"></i> Export Video
              </button>
            </div>
          </header>
          <div class="editor-main-content">
            <div class="editor-body">
              <div class="editor-panel media-panel">
                <div class="panel-header">
                  <h3>Media Bin</h3>
                  <label for="upload-video-input" class="action-button small-action">
                    <i class="fa-solid fa-upload"></i> Upload
                    <input type="file" id="upload-video-input" accept="video/*" style="display: none;" multiple>
                  </label>
                </div>
                <div id="media-bin" class="media-bin panel-content">
                  <div class="placeholder">
                    Add clips from the Generator to see them here.
                  </div>
                </div>
              </div>
              <div id="resizer-v1" class="resizer resizer-v"></div>
              <div class="editor-panel preview-panel">
                <div class="panel-header">
                  <h3>Sequence Preview</h3>
                </div>
                <div class="preview-panel-body">
                  <div id="video-preview-wrapper" class="video-preview-wrapper">
                    <div id="editor-placeholder" class="editor-placeholder placeholder"></div>
                    <video id="video-preview"></video>
                  </div>
                  <div class="playback-controls">
                    <button id="play-pause-button" class="play-pause-button" aria-label="Play/Pause" disabled>
                      <i id="play-icon" class="fa-solid fa-play" aria-hidden="true"></i>
                      <i id="pause-icon" class="fa-solid fa-pause" style="display: none;" aria-hidden="true"></i>
                    </button>
                    <div id="time-display" class="time-display">
                      <span id="current-time">00:00</span> / <span id="total-duration">00:00</span>
                    </div>
                  </div>
                </div>
              </div>
              <div id="resizer-v2" class="resizer resizer-v"></div>
              <div class="editor-panel tools-panel">
                <div class="panel-header">
                  <h3>Tools</h3>
                </div>
                <div class="panel-content">
                  <button id="add-text-button" class="action-button full-width" disabled>
                    <i class="fa-solid fa-font" aria-hidden="true"></i>
                    Add Caption
                  </button>
                  <div class="form-info">
                    <p>More tools like transitions coming soon!</p>
                  </div>
                </div>
                <div class="panel-header">
                  <h3>Properties</h3>
                </div>
                <div id="properties-panel" class="panel-content">
                  <div id="properties-placeholder" class="placeholder" style="padding: 0; font-size: 0.9rem;">
                    Select an item on the timeline to see its properties.
                  </div>
                  <div id="video-properties" style="display: none;">
                    <div class="form-group">
                      <label for="prop-video-volume">Volume</label>
                      <div class="slider-container">
                        <input type="range" id="prop-video-volume" min="0" max="100" value="100">
                        <span id="prop-video-volume-value">100%</span>
                      </div>
                    </div>
                    <div class="props-divider">
                      <span>Transform</span>
                      <button id="reset-transform-button" class="action-button small-action" aria-label="Reset transform properties">
                         <i class="fa-solid fa-arrow-rotate-left"></i> Reset
                      </button>
                    </div>
                    <div class="form-group">
                      <label for="prop-video-scale">Scale</label>
                      <div class="slider-container">
                        <input type="range" id="prop-video-scale" min="50" max="200" value="100">
                        <span id="prop-video-scale-value">100%</span>
                      </div>
                    </div>
                     <div class="form-group">
                      <label for="prop-video-pos-x">Position X</label>
                      <div class="slider-container">
                        <input type="range" id="prop-video-pos-x" min="-50" max="50" value="0">
                        <span id="prop-video-pos-x-value">0%</span>
                      </div>
                    </div>
                     <div class="form-group">
                      <label for="prop-video-pos-y">Position Y</label>
                      <div class="slider-container">
                        <input type="range" id="prop-video-pos-y" min="-50" max="50" value="0">
                        <span id="prop-video-pos-y-value">0%</span>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="prop-video-rotation">Rotation</label>
                      <div class="slider-container">
                        <input type="range" id="prop-video-rotation" min="-180" max="180" value="0">
                        <span id="prop-video-rotation-value">0¬∞</span>
                      </div>
                    </div>
                  </div>
                  <div id="text-properties" style="display: none;">
                    <div class="form-group">
                      <label for="prop-text-content">Text</label>
                      <textarea id="prop-text-content" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                      <label for="prop-font-family">Font</label>
                      <select id="prop-font-family">
                        <option>Google Sans</option>
                        <option>Arial</option>
                        <option>Verdana</option>
                        <option>Georgia</option>
                        <option>Times New Roman</option>
                        <option>Courier New</option>
                        <option value="'Brush Script MT', cursive">Brush Script</option>
                      </select>
                    </div>
                    <div class="settings-grid">
                      <div class="form-group">
                        <label for="prop-font-size">Size</label>
                        <div class="slider-container">
                          <input type="range" id="prop-font-size" min="10" max="100" value="40">
                          <span id="prop-font-size-value">40</span>
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="prop-font-color">Color</label>
                        <input type="color" id="prop-font-color" value="#FFFFFF">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div id="resizer-h" class="resizer resizer-h"></div>
            <div id="timeline-container" class="timeline-container">
              <div id="timeline-ruler-container">
                <div id="timeline-tools-vertical-header"></div>
                <div id="timeline-ruler-header"></div>
                <div id="timeline-ruler"></div>
              </div>
              <div id="timeline-body">
                <div id="timeline-tools-vertical">
                   <div id="tool-selection" class="tool-button-group">
                      <button id="select-tool-button" class="tool-button active" aria-label="Select tool (V)" title="Select tool (V)" data-tool="select">
                          <i class="fa-solid fa-arrow-pointer"></i>
                      </button>
                      <button id="split-tool-button" class="tool-button" aria-label="Split tool (C)" title="Split tool (C)" data-tool="split">
                          <i class="fa-solid fa-scissors"></i>
                      </button>
                  </div>
                  <div class="tool-divider"></div>
                   <div id="add-track-controls" class="tool-button-group">
                      <button id="add-video-track-button" class="tool-button" title="Add Video Track">
                          <i class="fa-solid fa-plus"></i><i class="fa-solid fa-video"></i>
                      </button>
                      <button id="add-text-track-button" class="tool-button" title="Add Text Track">
                          <i class="fa-solid fa-plus"></i><i class="fa-solid fa-font"></i>
                      </button>
                  </div>
                </div>
                <div id="timeline-track-headers">
                  <!-- Track headers (V1, T1) go here -->
                </div>
                <div id="timeline-scroll-container">
                  <div id="playhead"></div>
                  <div id="split-indicator"></div>
                  <div id="timeline-tracks">
                    <!-- Tracks go here -->
                  </div>
                  <!-- Insertion marker will be managed by JS -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <div id="settings-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h2 class="modal-title">Sequence Settings</h2>
      <div class="form-group">
        <label for="setting-duration">Duration (seconds)</label>
        <input type="number" id="setting-duration" min="1" max="60" step="1" class="modal-input">
        <div class="form-info" style="background: transparent; border: none; padding: 0.5rem 0 0;">
            <p>YouTube Shorts can be up to 60 seconds long.</p>
        </div>
      </div>
      <div class="modal-actions">
        <button id="settings-cancel-button" class="action-button secondary">Cancel</button>
        <button id="settings-save-button" class="action-button">Save</button>
      </div>
    </div>
  </div>

  <div id="error-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h2 class="modal-title">
          <i class="fa-solid fa-triangle-exclamation" style="color: var(--error-color);"></i> Generation Failed
      </h2>
      <div id="error-modal-body">
          <!-- Error details will be injected here -->
      </div>
      <div class="modal-actions">
        <button id="error-modal-close" class="action-button">Close</button>
      </div>
    </div>
  </div>
  <div id="credits-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content">
        <h2 class="modal-title">Buy Credits</h2>
        <div class="credit-packages">
          <div class="credit-package">
            <div class="package-icon">
              <i class="fa-solid fa-rocket"></i>
            </div>
            <h3>Starter Pack</h3>
            <p class="package-credits">500</p>
            <p class="credits-label">Credits</p>
            <button class="buy-button" data-price-id="price_1RtO69BiRVB8RnGOYYcuIxnl">Buy for $5</button>
          </div>
          <div class="credit-package popular">
            <div class="popular-badge">Most Popular</div>
            <div class="package-icon">
              <i class="fa-solid fa-star"></i>
            </div>
            <h3>Creator Pack</h3>
            <p class="package-credits">1100</p>
            <p class="credits-label">Credits</p>
            <button class="buy-button" data-price-id="price_1RtO6TBiRVB8RnGOMODcU64s">Buy for $10</button>
          </div>
          <div class="credit-package">
            <div class="package-icon">
              <i class="fa-solid fa-gem"></i>
            </div>
            <h3>Producer Pack</h3>
            <p class="package-credits">2500</p>
            <p class="credits-label">Credits</p>
            <button class="buy-button" data-price-id="price_1RtO6lBiRVB8RnGOwpt0SC27">Buy for $20</button>
          </div>
        </div>
        <div class="modal-actions">
          <button id="credits-cancel-button" class="action-button secondary">Cancel</button>
        </div>
      </div>
    </div>
  <!-- Vite will inject the bundled script here -->
</body>
</html>